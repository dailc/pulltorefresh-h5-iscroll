/**
 * pulltorefresh-h5-iscroll - 一款基于IScroll5的H5下拉刷新实现，包括多种皮肤的实现
 * @version v3.0.0
 * @author 
 */
!function(e,t){!function(){e.dataProcessFn=[],e.dataProcess=function(t,o){o=o||{},"string"==typeof o.dataPath&&(o.dataPath=[o.dataPath]);var n=[].slice.call(arguments),s={code:0,message:"",data:null,status:0,debugInfo:{type:"未知数据格式"}},a=o.isDebug||!1,r=o.dataPath,i=e.dataProcessFn,l=i.length,u=r.length,p=!1;if(!t)return s.message="接口返回数据为空!",s;n.push(s);for(var c=0;!p&&c<u;c++){n[1]=r[c];for(var d=0;!p&&d<l;d++){var f=i[d],h=f.apply(this,n);if(null!=h&&(1==h.code||c==u-1)){p=!0,s=h;break}}}return p||(s.message="没有数据处理函数或者接口数据返回格式不符合要求!",s.debugInfo.data=t),a||(s.debugInfo=void 0),s}}(),function(){function o(e,o,n){if(!(o&&e&&e.ReturnInfo&&e.BusinessInfo))return null;var s={type:"v6数据格式:"+o},a=e.ReturnInfo,r=e.BusinessInfo;e.UserArea;if("1"==a.Code)if("1"==r.Code){var i=t.getNameSpaceObj(e,o);i?(n.code=1,n.data=i):(n.code=0,n.message=n.message||"指定路径下没有找到数据",n.data=null,s.errorType="3")}else s.errorType="2",n.code=0,n.message=r.Description||"接口请求错误,后台业务逻辑处理出错!";else s.errorType="1",n.code=0,n.message=a.Description||"接口请求错误,后台程序处理出错!";return n.debugInfo=s,n}e.dataProcessFn.push(o)}(),function(){function o(e,o,n){if(!(o&&e&&e.status&&e.custom))return null;var s={type:"v7数据格式:"+o},a=e.status;if(n.status=a.code||0,n.message=a.text,"200"==a.code){var r=t.getNameSpaceObj(e,o);r?(n.code=1,n.data=r):(n.code=0,n.message=n.message||"指定路径下没有找到数据",n.data=null,s.errorType="3")}else n.code=0,s.errorType="2",n.message=n.message||"status状态错误";return n.debugInfo=s,n}e.dataProcessFn.push(o)}(),t.namespace("dataProcess",e.dataProcess)}({},PullToRefreshTools),function(e,t){function o(e){if(null==e||"string"!=typeof e)return null;var t,o=document.createElement("div"),n=document.createDocumentFragment();for(o.innerHTML=e;t=o.firstChild;)n.appendChild(t);return n}function n(e){var o=this,n=(document.querySelector(e.listContainer||"#listdata"),e.template),a="#item-template";"string"!=typeof n||"."!=n.charAt(0)&&"#"!=n.charAt(0)||(a=n,e.template="");var r=document.querySelector(a);if(r&&(e.template=e.template||r.innerHTML.toString()||""),e=t.extend(!0,{},l,e),s=e.skin||PullToRefreshTools.skin.defaults,!s)return void console.error("错误:传入的下拉刷新皮肤错误,超出范围!");var i=e.setting;i.container=e.container,i.down&&(i.down.callback=function(){o.pullDownCallback()}),i.up&&(i.up.callback=function(){o.pullUpCallback()}),o.respnoseEl=t.selector(e.listContainer),o.options=e,o.setting=i,o.isShouldNoMoreData=!0,o.currPage=o.options.initPageIndex,o.setting.up&&o.setting.up.auto&&o.currPage--,o.initAllEventListeners(),o.pullToRefreshInstance=new s(e.setting)}var s,a=t.dataProcess,r="ontouchstart"in document,i=r?"tap":"click",l={isDebug:!1,setting:{down:{isSuccessTips:!0},up:{auto:!0}},type:"POST",initPageIndex:0,pageSize:10,url:null,template:null,dataRequest:null,dataChange:null,itemClick:null,success:null,error:null,refresh:null,isAutoRender:!0,itemSelector:"li",listContainer:"#listdata",container:"#pullrefresh",delay:0,timeout:6e3,accepts:{script:"text/javascript, application/javascript, application/x-javascript",json:"application/json",xml:"application/xml, text/xml",html:"text/html",text:"text/plain"},contentType:"application/x-www-form-urlencoded",headers:null};n.prototype.pullDownCallback=function(){var e=this;e.loadingDown||(e.isPullDown=!0,e.loadingDown=!0,e.currPage=e.options.initPageIndex,setTimeout(function(){e.ajaxRequest()},e.options.delay),e.options.refresh&&e.options.refresh(!0))},n.prototype.pullUpCallback=function(){var e=this;e.loadingUp||(e.isPullDown=!1,e.loadingUp=!0,e.currPage++,setTimeout(function(){e.ajaxRequest()},e.options.delay))},n.prototype.initAllEventListeners=function(){var e=this;e.setElemListeners()},n.prototype.setElemListeners=function(){var e=this;e.options.itemClick&&mui(e.options.listContainer).on(i,e.options.itemSelector,e.options.itemClick)},n.prototype.refresh=function(){var e=this;e.options.up&&e.pullToRefreshInstance.enablePullUp?e.loadingUp||(e.clearResponseEl(),e.currPage=e.options.initPageIndex-1,e.loadingMore()):(e.clearResponseEl(),e.pullDownCallback())},n.prototype.loadingMore=function(e){var t=this;t.loadingMoreSuccess=e,t.pullToRefreshInstance.finished&&(t.pullToRefreshInstance.refresh(!0),t.isShouldNoMoreData=!0),t.pullToRefreshInstance.pullupLoading()},n.prototype.disablePullupToRefresh=function(){this.pullToRefreshInstance.disablePullupToRefresh()},n.prototype.enablePullupToRefresh=function(){this.pullToRefreshInstance.enablePullupToRefresh()},n.prototype.ajaxRequest=function(){var e=this;if(!e.options.url)return e.options.isDebug&&console.error("error***url无效,无法访问"),void e.errorRequest(null,null,"请求url为空!");var t=function(t){var o="";o="function"==typeof e.options.url?e.options.url():e.options.url,mui.ajax(o,{data:t,dataType:"json",timeout:e.options.timeout,type:e.options.type,accepts:e.options.accepts,headers:e.options.headers,contentType:e.options.contentType,success:function(t){e.successRequest(t)},error:function(t,o){e.errorRequest(t,o,"请求失败!")}})};if(e.options.dataRequest){var o=e.options.dataRequest(e.currPage,function(e){t(e)});void 0!==o&&t(o)}else e.options.isDebug&&console.warn("warning***请注意dataRequest不存在,默认数据为空"),t()},n.prototype.errorRequest=function(e,t,o){var n=this;n.isShouldNoMoreData=!1,n.refreshState(!1),n.currPage--,n.currPage=n.currPage>=n.options.initPageIndex?n.currPage:n.options.initPageIndex,n.options.error&&n.options.error(e,t,o)},n.prototype.successRequest=function(e,t){var n=this;if(!e)return n.options.isDebug&&console.log("warning***返回的数据为空,请注意！"),n.isShouldNoMoreData=!1,void n.refreshState(!1);if(n.options.isDebug&&console.log("下拉刷新返回数据:"+JSON.stringify(e)),e=n.options.dataChange?n.options.dataChange(e):n.defaultChangeResponseData(e),n.options.isAutoRender){n.isPullDown&&n.clearResponseEl();var s=0;if(window.Mustache)if(e&&Array.isArray(e)&&e.length>0){for(var a="",r=0;r<e.length;r++){var i=e[r],l="";n.options.template&&("string"==typeof n.options.template?l=n.options.template:"function"==typeof n.options.template&&(l=n.options.template(i)));var u=Mustache.render(l,i);a+=u,s++}""!=a&&n.respnoseEl.appendChild(o(a))}else n.isShouldNoMoreData=!1;else n.isShouldNoMoreData=!1,1==n.options.isDebug&&console.error("error***没有包含mustache.min.js,无法进行模板渲染")}n.options.success&&"function"==typeof n.options.success&&n.options.success(e,n.isPullDown||n.currPage==n.options.initPageIndex),t||n.refreshState(!0,s)},n.prototype.defaultChangeResponseData=function(e){var t=a(e,{dataPath:["custom.infoList","custom.list","UserArea.InfoList"]});return t.data},n.prototype.refreshState=function(e,t){var o=this;t=t||0,o.pullToRefreshInstance.setSuccessTips&&o.pullToRefreshInstance.setSuccessTips("更新"+t+"条数据"),o.isPullDown&&(o.pullToRefreshInstance.endPullDownToRefresh(e),o.pullToRefreshInstance.finished&&(o.pullToRefreshInstance.refresh(!0),o.isShouldNoMoreData=!0)),o.isShouldNoMoreData?o.pullToRefreshInstance.endPullUpToRefresh(!1,e):o.pullToRefreshInstance.endPullUpToRefresh(!0,e),o.loadingDown=!1,o.loadingUp=!1},n.prototype.clearResponseEl=function(){var e=this;e.options.isAutoRender&&e.respnoseEl&&(e.respnoseEl.innerHTML="")},n.init=function(e){return new n(e)},t.namespace("bizlogic",n)}({},PullToRefreshTools);